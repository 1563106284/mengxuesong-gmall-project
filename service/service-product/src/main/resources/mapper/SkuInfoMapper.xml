<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.gmall.product.mapper.SkuInfoMapper">
    <resultMap id="BaseResultMap" type="com.atguigu.gmall.model.product.SkuInfo">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="spuId" column="spu_id" jdbcType="BIGINT"/>
        <result property="price" column="price" jdbcType="DECIMAL"/>
        <result property="skuName" column="sku_name" jdbcType="VARCHAR"/>
        <result property="skuDesc" column="sku_desc" jdbcType="VARCHAR"/>
        <result property="weight" column="weight" jdbcType="DECIMAL"/>
        <result property="tmId" column="tm_id" jdbcType="BIGINT"/>
        <result property="category3Id" column="category3_id" jdbcType="BIGINT"/>
        <result property="skuDefaultImg" column="sku_default_img" jdbcType="VARCHAR"/>
        <result property="isSale" column="is_sale" jdbcType="TINYINT"/>
    </resultMap>
<!--    查询所有的sku id-->
    <select id="selectSkuId" resultType="java.lang.Long">
     select id from sku_info
     </select>

    <sql id="Base_Column_List">
        id,
        spu_id,
        price,
        sku_name,
        sku_desc,
        weight,
        tm_id,
        category3_id,
        sku_default_img,
        is_sale
    </sql>
    <select id="get1010Price" resultType="java.math.BigDecimal">
        SELECT price
        FROM sku_info
        WHERE id = #{skuId}
    </select>


    <select id="getBrotherSkuSaleValue" resultType="com.atguigu.gmall.product.to.ValueJsonTo">
        SELECT a.sku_id,
               GROUP_CONCAT(DISTINCT sale_attr_value_id
                            ORDER BY sale_attr_value_id ASC
                            SEPARATOR '|') AS value_json
        FROM (SELECT a.id sku_id,
                     b.id vId,
                     b.spu_id,
                     b.sale_attr_value_id,
                     c.base_sale_attr_id
              FROM sku_info a
                           LEFT JOIN sku_sale_attr_value b
                      on a.id = b.sku_id
                           LEFT JOIN spu_sale_attr_value c
                      on c.id = b.sale_attr_value_id
              WHERE a.spu_id = #{spuId}
              ORDER BY a.id, c.base_sale_attr_id, b.sale_attr_value_id) a
        GROUP BY a.sku_id
    </select>
</mapper>
